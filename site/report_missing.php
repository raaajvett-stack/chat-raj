<html lang="ar" dir="rtl"><head>
    
    
    
    
    
    <!-- ====================================================== -->
    <!--  بداية: كود تحليلات جوجل (Google Analytics) -->
    <!--  استبدل G-XXXXXXXXXX بمعرف القياس الخاص بك  -->
    <!-- ====================================================== -->
    <script type="text/javascript" async="" src="https://www.googletagmanager.com/gtag/js?id=G-PL2FZX87EN&amp;cx=c&amp;gtm=45je57u1h1za200&amp;tag_exp=101509157~103116026~103200004~103233427~104684208~104684211~105087538~105087540~105103161~105103163"></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-PL2FZX87EN');
    </script>
    <!-- ====================================================== -->
    <!--  نهاية: كود تحليلات جوجل (Google Analytics)   -->
    <!-- ====================================================== -->

    
    
    
    
    
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الإبلاغ عن سيارة مفقودة - مفقودات الحرب</title>
    <!-- تحديث روابط ملفات CSS للتصميم الجديد -->
    <link rel="stylesheet" href="css/new-style.css">
    <link rel="stylesheet" href="css/new-effects.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/homepage-responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&amp;display=swap">
    
        <!-- روابط التواصل الاجتماعي -->
    <meta property="og:title" content="مفقودات الحرب">
    <meta property="og:description" content="هذه المنصة مخصصة لتلقي البلاغات عن السيارات المفقودة والإبلاغ عن العثور على مركبات مجهولة. يمكنك استخدام هذه المنصة للإبلاغ الفوري وسوف يتم التعامل مع البلاغات بسرية تامة. كما يمكنك الاستعلام عن حالة البلاغات المقدمة سابقاً.

">
    <meta property="og:image" content="images/logo.png">
    <style>

				.mtai-force-dark-theme :not(#magictool-ext,video,source){
					color:white !important;
				}
				.mtai-force-dark-theme{
					background-color: #1e1e1e;
				}
				.mtai-force-dark-theme div:not([class*="overlay"]):not([class*="video"]),.mtai-force-dark-theme article,.mtai-force-dark-theme section,.mtai-force-dark-theme table{
					background-color: #1e1e1e;
				}
			
				
				.mtai-force-light-theme :not(#magictool-ext,video,source){
					color:black !important;
					
				}

				.mtai-force-light-theme{
					background-color: white;
				}

				.mtai-force-light-theme div:not([class*="overlay"]):not([class*="video"]), .mtai-force-light-theme article, .mtai-force-light-theme section,.mtai-force-light-theme table{
					background-color: white;
				}

			</style></head>
<body class="modal-open page-loaded">
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                                <span class="logo-text">مفقودات الحرب</span>
            </div>
            
                        <div class="social-links">
                                
                                
                            </div>
                        
            <!-- إضافة عنصر الخلفية المتحركة -->
            <div class="gradient-animation"></div>
        </div>
    <div class="gradient-animation"></div></header>

<div class="main-content">
    <div class="container">

    <a href="index.php" class="btn btn-info mb-3"><i class="fas fa-home"></i> العودة للصفحة الرئيسية</a>


        <div class="advertisement-container advertisement-top"><h3 class="advertisement-title">واتساب</h3><div class="advertisement-html"><div class="whatsapp-banner">
<h2>📢 تابع جديد مفقودات الحرب</h2>
<p>عندك عربية مفقودة؟ أو داير تتابع كل جديد؟ 🚗💔</p>
<p>اشترك في قناتنا على واتساب عشان توصلك البلاغات والمعلومات أول بأول.</p>
<a href="https://whatsapp.com/channel/0029Vb5hJOvKrWQzgEzKsz1H" target="_blank" class="whatsapp-btn">🟢 اشترك في القناة</a>
</div>
<style>
.whatsapp-banner {
max-width: 500px;
margin: 30px auto;
padding: 25px;
background: linear-gradient(135deg, #f0fff3, #e6f8e9);
border: 1px solid #a7e0b8;
border-radius: 18px;
text-align: center;
font-family: 'Segoe UI', Tahoma, sans-serif;
color: #333;
box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
}
.whatsapp-banner h2 {
font-size: 20px;
color: #128C7E; /* WhatsApp Dark Green */
margin-bottom: 10px;
}
.whatsapp-banner p {
font-size: 15px;
margin-bottom: 10px;
line-height: 1.6;
}
.whatsapp-btn {
display: inline-block;
margin-top: 10px;
background-color: #25D366; /* WhatsApp Green */
color: white;
padding: 12px 20px;
border-radius: 10px;
text-decoration: none;
font-weight: bold;
transition: background 0.3s ease;
}
.whatsapp-btn:hover {
background-color: #128C7E; /* WhatsApp Dark Green */
}
</style></div></div>
        <div class="form-container animate-on-scroll">
            <h2 class="form-title">الإبلاغ عن سيارات مفقودة</h2>

            
            
                            <div class="alert alert-info report-limit-info mb-4">
                    <i class="fas fa-info-circle"></i>
                    عدد بلاغاتك الحالي: **0** من أصل **3** بلاغ مسموح به.
                    <br>
                    يمكنك طلب زيادة هذا الحد من <a href="profile.php" class="text-accent">صفحتك الشخصية</a>.
                </div>

                            
            <form id="missing-car-form" class="report-form" method="POST" enctype="multipart/form-data" onsubmit="return handleSubmit(event)">
                <input type="hidden" name="csrf_token" value="dc0d0dbfccce8aadc2086a79a985dd9550c51758372a48024213a38d6adbfb2b">

                <div class="form-section stagger-item show">
                    <h3 class="section-title">
                        <i class="fas fa-user"></i>
                        معلومات المبلغ
                    </h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reporter_name" class="form-label required">اسم المبلغ</label>
                            <input type="text" id="reporter_name" name="reporter_name" class="form-control" maxlength="100" required="">
                        </div>
                        <div class="form-group">
                            <label for="car_owner_name" class="form-label required">اسم مالك السيارة</label>
                            <input type="text" id="car_owner_name" name="car_owner_name" class="form-control" maxlength="100" required="">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="address" class="form-label required">العنوان</label>
                            <input type="text" id="address" name="address" class="form-control" maxlength="200" required="">
                        </div>
                        <div class="form-group">
                            <label for="phone" class="form-label required">رقم الهاتف (بالصيغة الدولية)</label>
                            <input type="tel" id="phone" name="phone" class="form-control" placeholder="+249XXXXXXXXX" pattern="^\+?[0-9]{10,15}$" title="يرجى إدخال رقم الهاتف بالصيغة الدولية (مثال: +249XXXXXXXXX)" required="">
                            <small class="form-help">أدخل رقم الهاتف بالصيغة الدولية (مثال: +249XXXXXXXXX)</small>
                        </div>
                    </div>
                </div>

                <div class="form-section stagger-item show">
                    <h3 class="section-title">
                        <i class="fas fa-car"></i>
                        معلومات السيارة
                    </h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="manufacture_year" class="form-label required">سنة الصنع</label>
                            <input type="number" id="manufacture_year" name="manufacture_year" class="form-control" min="1950" max="2025" required="">
                        </div>
                        <div class="form-group">
                            <label for="plate_number" class="form-label required">رقم اللوحة</label>
                            <input type="text" id="plate_number" name="plate_number" class="form-control" maxlength="15" placeholder="مثال: خ/2 12345">
                            <small class="form-help">يمكن استخدام الحروف والأرقام والرموز (حتى 15 خانة).</small>
                            </div>
                        <div class="form-group">
                            <label for="chassis_number" class="form-label required">رقم الشاسيه</label>
                            <input type="text" id="chassis_number" name="chassis_number" class="form-control">
                            <small class="form-help important-notice">يرجى كتابة رقم الشاسيه كما هو مكتوب تماماً في شهادة البحث</small>
                        </div>
                    </div>
                </div>

                                <div class="form-section stagger-item show">
                    <h3 class="section-title">
                        <i class="fas fa-receipt"></i>
                        معلومات الدفع (مطلوب)
                    </h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="payment_amount" class="form-label required">مبلغ الدفع</label>
                            <input type="number" id="payment_amount" name="payment_amount" class="form-control" step="0.01" min="0" placeholder="أدخل مبلغ الدفع" required="">
                            <small class="form-help">أدخل المبلغ المدفوع لتسجيل البلاغ</small>
                        </div>
                        <div class="form-group">
                            <label for="receipt" class="form-label required">
                                <i class="fas fa-upload"></i>
                                إيصال الدفع
                            </label>
                            <div class="file-upload-wrapper">
                                <input type="file" class="form-control-file" id="receipt" name="receipt" accept="image/*,.pdf" required="">
                                <div class="file-upload-text">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <span id="file-upload-instruction" style="display: block;">اختر ملف أو اسحبه هنا</span>
                                    <span id="selected-file-name" class="selected-file-name"></span>
                                </div>
                                <div id="file-size-info" class="file-size-info"></div>
                            </div>
                            <small class="form-help">
                                يرجى رفع إيصال الدفع (بنك الخرطوم، ح/ 2801193، باسم شاهد حسن احمد رجب).
                                الملفات المدعومة: JPG, PNG, PDF (الحد الأقصى: 5MB)
                            </small>
                        </div>
                    </div>
                </div>
                
                <div class="form-group mb-20 stagger-item show">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="whatsapp_consent" name="whatsapp_consent" value="1">
                        <label class="form-check-label" for="whatsapp_consent">
                            أوافق على تلقي إشعارات عبر الواتساب في حالة العثور على سيارتي المفقودة وفقًا <a href="privacy_policy.php" target="_blank" class="text-accent">لسياسة الخصوصية</a>
                        </label>
                    </div>
                </div>

                <div class="form-actions stagger-item show">
                    <button type="submit" class="btn btn-primary" id="submit-btn">
                        <i class="fas fa-paper-plane"></i>
                        <span id="submit-text">تقديم البلاغ</span>
                        <span id="submit-spinner" class="loading-spinner hidden"></span>
                    <div class="glow-effect"></div></button>
                    <button type="reset" class="btn btn-secondary">
                        <i class="fas fa-undo"></i>
                        إعادة تعيين النموذج
                    </button>
                </div>
            </form>
        </div>

            </div>
</div>

<div id="payment-info-modal-report-missing" class="modal-overlay active">
    <div class="modal-content">
        <h3 class="modal-title">رسوم فتح البلاغ لدعم الموقع</h3>
        <p>نشكر اهتمامك بتقديم بلاغ. لضمان استمرارية عمل الموقع وتقديم الدعم الفني اللازم، يرجى العلم بأنه يتوجب دفع رسوم رمزية بقيمة <strong id="display-price-modal-report">4,000 جنيه</strong> **لكل بلاغ** يتم تقديمه.</p>
        
        <p id="countdown-message-report" class="text-center" style="font-weight: bold; color: var(--accent-color); margin-top: -10px; margin-bottom: 20px; font-size: 1.1em;">سيصبح سعر فتح البلاغ 5,000 جنيه بعد
                    <span style="color: #dc3545;">05:53</span></p>
        <p>يمكنكم إيداع المبلغ في الحساب البنكي التالي:</p>
        <ul class="bank-details">
            <li><strong>البنك:</strong> بنك الخرطوم</li>
            <li><strong>رقم الحساب:</strong> 2801193</li>
            <li><strong>اسم صاحب الحساب:</strong> شاهد حسن احمد رجب</li>
        </ul>
        <p><strong>هام جداً:</strong> بعد إتمام عملية الدفع، يرجى التأكد من رفع صورة واضحة لإشعار بنكك في حقل "إيصال الدفع" المخصص لذلك في نموذج البلاغ أدناه. لن يتم مراجعة البلاغ بدون التحقق من الإيصال.</p>
        <button id="close-report-modal-btn" class="btn btn-primary">لقد قرأت وفهمت، سأقوم بالدفع وتقديم البلاغ<div class="glow-effect"></div></button>
    </div>
</div>

<div id="report-success-modal" class="modal-overlay">
    <div class="modal-content">
        <h3 class="modal-title" style="border-color: #28a745; color: #28a745;">
            <i class="fas fa-check-circle"></i>
            تم تقديم البلاغ بنجاح
        </h3>
        <p>شكرًا لك، لقد تم تسجيل بلاغك بنجاح .</p>

        <div class="approval-notice">
            <p style="margin-bottom: 10px;"><strong>مواعيد مراجعة البلاغات:</strong></p>
            <p style="margin-bottom: 10px;">
                مواعيد العمل الرسمية من <strong>الساعة 9:00 صباحًا وحتى 6:00 مساءً</strong>.
            </p>
            <ul style="padding-right: 20px; margin: 0;">
                <li>إذا قدمت بلاغك خلال هذه الأوقات، سيتم مراجعته في <strong>أقل من 3 ساعات</strong>.</li>
                <li>البلاغات التي تُقدم خارج أوقات العمل قد يتأخر تفعيلها حتى بداية يوم العمل التالي.</li>
            </ul>
        </div>
        
        <p>يمكنك التواصل معنا عبر واتساب للاستفسار: <strong>+249918014555</strong></p>
        <p>يمكنك متابعة حالة بلاغك من خلال <a href="profile.php" style="color: var(--primary-color); font-weight: bold;">صفحتك الشخصية</a>.</p>

        <button id="close-report-success-btn" class="btn btn-primary" style="background-color: #28a745;">
            <i class="fas fa-check"></i>
            فهمت، شكرًا لكم
        <div class="glow-effect"></div></button>
    </div>
</div>

<style>
/* ... (Existing CSS code for form elements and alerts) ... */
.form-section {
    margin-bottom: 35px;
    padding-bottom: 25px;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
}

.form-section:last-child {
    border-bottom: none;
    margin-bottom: 0;
}

.section-title {
    color: var(--primary-color);
    font-size: 1.3rem;
    font-weight: 600;
    margin-bottom: 25px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.form-label.required:after {
    content: "*";
    color: #dc3545;
    margin-right: 5px;
}

.form-check {
    display: flex;
    align-items: center;
    gap: 10px;
}

.form-check-input {
    width: 20px;
    height: 20px;
}

.form-actions {
    display: flex;
    gap: 15px;
    margin-top: 30px;
}

.hidden {
    display: none;
}

.loading-spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

.alert {
    border-radius: var(--border-radius);
    padding: 15px 20px;
    margin-bottom: 25px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.alert-success {
    background-color: rgba(40, 167, 69, 0.1);
    border-right: 4px solid #28a745;
    color: #155724;
}

.alert-danger {
    background-color: rgba(220, 53, 69, 0.1);
    border-right: 4px solid #dc3545;
    color: #721c24;
}

/* تنسيق إضافي للتنبيه المهم */
.important-notice {
    color: #dc3545;
    font-weight: bold;
    font-size: 0.9rem;
    margin-top: 5px;
    display: block;
}

/* Modal Styles for payment-info-modal-report-missing (copied from register.php) */
.modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.7); display: flex; justify-content: center;
    align-items: center; z-index: 1050; opacity: 0; visibility: hidden;
    transition: opacity 0.4s ease, visibility 0.4s ease; direction: rtl; padding: 15px;
    box-sizing: border-box; overflow-y: auto;
}
.modal-overlay.active { opacity: 1; visibility: visible; }
.modal-content {
    background-color: #fff; padding: 30px 40px; border-radius: var(--border-radius, 10px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15); max-width: 600px; width: 100%; max-height: 90vh;
    overflow-y: auto; text-align: right; transform: translateY(-30px) scale(0.95);
    transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1), opacity 0.4s ease; opacity: 0; margin: auto;
}
.modal-overlay.active .modal-content { transform: translateY(0) scale(1); opacity: 1; }
.bank-details {
    list-style: none; padding: 15px; margin: 20px 0; background-color: #f8f9fa;
    border: 1px solid #eee; border-right: 5px solid var(--primary-color, #00a9a5);
    border-radius: var(--border-radius, 8px);
}
.bank-details li { margin-bottom: 10px; font-size: 1rem; color: #333; }
.bank-details li strong { color: var(--primary-color, #00a9a5); font-weight: 600; min-width: 110px; display: inline-block; }
.bank-details li:last-child { margin-bottom: 0; }
#close-report-modal-btn {
    display: block; width: 100%; box-sizing: border-box; margin: 25px auto 0;
    padding: 12px 25px; font-size: 1.1rem; font-weight: 600; color: #fff; border: none;
    border-radius: var(--border-radius, 5px); cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease; text-align: center;
    background-color: var(--primary-color, #00a9a5);
}
#close-report-modal-btn:hover { background-color: var(--accent-color, #007f7c); transform: translateY(-2px); }

/* تحسينات لرفع الملف */
.file-upload-wrapper {
    position: relative;
    border: 2px dashed var(--border-color, #ddd); /* Border color using CSS variable */
    border-radius: var(--border-radius, 8px);
    padding: 30px;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
    background-color: var(--light-bg, #f8f9fa); /* Light background using CSS variable */
    display: flex; /* Use flexbox for better alignment */
    flex-direction: column; /* Stack children vertically */
    align-items: center; /* Center horizontally */
    justify-content: center; /* Center vertically */
    min-height: 120px; /* Ensure sufficient height for the drop zone */
}

.file-upload-wrapper:hover,
.file-upload-wrapper.dragover { /* New class for drag-over state */
    border-color: var(--accent-color, #00a9a5); /* Highlight on hover/drag */
    background-color: var(--primary-light, rgba(0, 169, 165, 0.08)); /* Lighter background */
}

.form-control-file {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0; /* Make it invisible but clickable */
    cursor: pointer;
    z-index: 10; /* Ensure it's above other elements for clicks */
}

.file-upload-text {
    color: var(--muted-text, #6c757d);
    font-size: 1.1rem;
    display: flex; /* Flex for icon and text */
    flex-direction: column;
    align-items: center;
    gap: 10px; /* Space between icon and text */
    pointer-events: none; /* Allows clicks to pass through to the input */
    z-index: 5; /* Below the input, above background */
    width: 100%; /* Take full width */
}

.file-upload-text i {
    font-size: 2.5rem; /* Larger icon */
    display: block;
    color: var(--primary-color, #00a9a5);
    transition: color 0.3s ease;
}

.file-upload-wrapper:hover .file-upload-text i {
    color: var(--accent-color, #007f7c); /* Change icon color on hover */
}

.selected-file-name {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-color, #333);
    margin-top: 5px;
    word-break: break-all; /* Break long file names */
}

.file-size-info {
    font-size: 0.85rem;
    color: var(--muted-text, #6c757d);
    margin-top: 5px;
}

/* حالة عند اختيار ملف */
.file-upload-wrapper.has-file {
    border-color: var(--success-color, #28a745); /* Green border when file selected */
    background-color: var(--success-light, rgba(40, 167, 69, 0.1)); /* Light green background */
}

.file-upload-wrapper.has-file .file-upload-text i {
    color: var(--success-color, #28a745); /* Green icon */
}

.file-upload-wrapper.has-file .file-upload-instruction {
    display: none; /* Hide initial instruction text */
}

@media (max-width: 768px) {
    .modal-content { padding: 25px 20px; max-height: 85vh; }
    .modal-title { font-size: 1.4rem; margin-bottom: 15px; padding-bottom: 10px; }
    .modal-content p { font-size: 0.95rem; line-height: 1.6; margin-bottom: 12px; }
    .bank-details { padding: 15px; margin: 15px 0; }
    .bank-details li { font-size: 0.95rem; margin-bottom: 8px; }
    .bank-details li strong { min-width: 100px; }
    #close-report-modal-btn { padding: 12px 20px; font-size: 1rem; margin-top: 20px; }
}

@media (max-width: 480px) {
    .modal-content { padding: 20px 15px; }
    .modal-title { font-size: 1.3rem; }
    .modal-content p, .bank-details li { font-size: 0.9rem; }
    .bank-details li strong { display: block; min-width: auto; margin-bottom: 3px; color: var(--primary-color, #00a9a5); }
    .bank-details li { margin-bottom: 10px; }
    #close-report-modal-btn { padding: 10px 15px; font-size: 0.95rem; }
}

/* نافذة النجاح */
#report-success-modal .modal-overlay { 
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    background-color: rgba(0, 0, 0, 0.7); 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    z-index: 1050; 
    opacity: 0; 
    visibility: hidden; 
    transition: opacity 0.4s ease, visibility 0.4s ease; 
    direction: rtl; 
    padding: 15px; 
    box-sizing: border-box; 
    overflow-y: auto; 
}

#report-success-modal .modal-overlay.active { 
    opacity: 1; 
    visibility: visible; 
}

.approval-notice {
    background-color: rgba(255, 193, 7, 0.1); 
    border-right: 4px solid #ffc107; 
    padding: 15px;
    margin: 20px 0;
    border-radius: var(--border-radius, 8px);
    line-height: 1.6;
}

.approval-notice p {
    margin-bottom: 10px;
    color: #555;
}

.approval-notice strong {
    color: #333;
}

.approval-notice ul {
    list-style-type: disc;
    margin: 10px 0;
}

.approval-notice li {
    margin-bottom: 8px;
    line-height: 1.5;
}

#close-report-success-btn {
    display: block;
    width: 100%;
    box-sizing: border-box;
    margin: 25px auto 0;
    padding: 12px 25px;
    font-size: 1.1rem;
    font-weight: 600;
    color: #fff;
    border: none;
    border-radius: var(--border-radius, 5px);
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
    text-align: center;
}

#close-report-success-btn:hover {
    background-color: #218838;
    transform: translateY(-2px);
}

/* تنسيقات النافذة المنبثقة للتنبيه (Auth Modal) - محدّث */
#authModal {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.7); display: flex; justify-content: center;
    align-items: center; z-index: 1050; opacity: 0; visibility: hidden;
    transition: opacity 0.4s ease, visibility 0.4s ease; direction: rtl; padding: 15px;
    box-sizing: border-box; overflow-y: auto;
}
#authModal.active { opacity: 1; visibility: visible; }
#authModal .modal-content { /* يجب أن يكون تابعًا لـ #authModal لضمان الخصوصية */
    background-color: #fff; padding: 30px; border-radius: var(--border-radius, 10px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15); max-width: 500px; width: 90%; max-height: 90vh;
    overflow-y: auto; text-align: center; transform: translateY(-30px) scale(0.95);
    transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1), opacity 0.4s ease; opacity: 0;
    margin: auto; /* لضمان التوسيط الجيد */
}
#authModal.active .modal-content { transform: translateY(0) scale(1); opacity: 1; }

#authModal .close-button {
    position: absolute; /* تأكد من absolute بالنسبة للـ modal-content */
    top: 15px;
    left: 25px; /* غير إلى Left ليكون في الزاوية العلوية اليسرى في الـ RTL */
    color: #aaa;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    transition: color 0.3s ease, transform 0.3s ease;
}
#authModal .close-button:hover,
#authModal .close-button:focus {
    color: #d32f2f;
    text-decoration: none;
    transform: scale(1.1);
}

#authModal .modal-title { /* لتنسيق عنوان النافذة */
    margin-top: 0;
    color: var(--primary-color);
    font-size: 1.8rem;
    margin-bottom: 25px;
    border-bottom: 2px solid var(--primary-color);
    padding-bottom: 10px;
}
#authModal .modal-buttons {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-top: 30px;
}
#authModal .modal-buttons .btn {
    padding: 10px 20px;
    font-size: 1rem;
}
</style>

<div id="authModal" class="modal-overlay">
    <div class="modal-content">
        <span class="close-button">×</span>
        <h3 class="modal-title">تنبيه تسجيل الدخول</h3>
        <p>يجب عليك تسجيل الدخول أو إنشاء حساب جديد لتتمكن من تقديم بلاغ.</p>
        <div class="modal-buttons">
            <button id="redirectToRegister" class="btn btn-primary">إنشاء حساب جديد<div class="glow-effect"></div></button>
            <button id="redirectToLogin" class="btn btn-secondary">تسجيل الدخول</button>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // إظهار نافذة التنبيه للمستخدمين غير المسجلين عند تحميل الصفحة
    const userLoggedIn = true;
    
    // عناصر النافذة المنبثقة للتنبيه (Auth Modal)
    const authModal = document.getElementById('authModal');
    const closeButton = authModal ? authModal.querySelector('.close-button') : null;
    const redirectToRegister = document.getElementById('redirectToRegister');
    const redirectToLogin = document.getElementById('redirectToLogin');

    function showAuthModal() {
        if (authModal) {
            // إخفاء أي نوافذ أخرى قد تكون مفتوحة لضمان ظهور هذه النافذة فقط
            const paymentModal = document.getElementById('payment-info-modal-report-missing');
            const successModal = document.getElementById('report-success-modal');
            
            if (paymentModal && paymentModal.classList.contains('active')) {
                paymentModal.classList.remove('active');
            }
            if (successModal && successModal.classList.contains('active')) {
                successModal.classList.remove('active');
            }
            
            // إظهار نافذة تسجيل الدخول
            authModal.classList.add('active');
            document.body.classList.add('modal-open'); // منع التمرير في الخلفية
        }
    }

    function hideAuthModal() {
        if (authModal) {
            authModal.classList.remove('active');
            document.body.classList.remove('modal-open'); // إعادة تمكين التمرير
        }
    }

    // إظهار نافذة التنبيه للمستخدمين غير المسجلين فورًا عند تحميل الصفحة
    if (!userLoggedIn) {
        showAuthModal();
    }
    
    // معالجة رفع الملف (محسن)
    const fileInput = document.getElementById('receipt');
    const fileUploadWrapper = document.querySelector('.file-upload-wrapper');
    const fileUploadInstruction = document.getElementById('file-upload-instruction');
    const selectedFileNameSpan = document.getElementById('selected-file-name');
    const fileSizeInfoDiv = document.getElementById('file-size-info');

    if (fileInput && fileUploadWrapper) {
        // دالة لتحديث عرض الملف
        function updateFileUploadDisplay() {
            if (fileInput.files && fileInput.files[0]) {
                const file = fileInput.files[0];
                const fileName = file.name;
                const fileSize = (file.size / (1024 * 1024)).toFixed(2); // بالميجابايت

                // التحقق من حجم الملف
                if (file.size > 5 * 1024 * 1024) { // 5MB
                    alert('حجم الملف كبير جداً. الحد الأقصى 5 ميجابايت.');
                    fileInput.value = ''; // مسح الملف المحدد
                    fileUploadWrapper.classList.remove('has-file');
                    fileUploadInstruction.style.display = 'block'; // إعادة إظهار التعليمات
                    selectedFileNameSpan.textContent = '';
                    fileSizeInfoDiv.textContent = '';
                    return;
                }

                fileUploadWrapper.classList.add('has-file');
                fileUploadInstruction.style.display = 'none'; // إخفاء التعليمات
                selectedFileNameSpan.textContent = `تم اختيار: ${fileName}`;
                fileSizeInfoDiv.textContent = `(${fileSize} MB)`;
            } else {
                // لا يوجد ملف محدد
                fileUploadWrapper.classList.remove('has-file');
                fileUploadInstruction.style.display = 'block'; // إعادة إظهار التعليمات
                selectedFileNameSpan.textContent = '';
                fileSizeInfoDiv.textContent = '';
            }
        }

        // الاستماع لتغيير الملف عبر النقر أو السحب والإفلات
        fileInput.addEventListener('change', updateFileUploadDisplay);

        // دعم السحب والإفلات
        fileUploadWrapper.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploadWrapper.classList.add('dragover');
        });

        fileUploadWrapper.addEventListener('dragleave', () => {
            fileUploadWrapper.classList.remove('dragover');
        });

        fileUploadWrapper.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploadWrapper.classList.remove('dragover');

            if (e.dataTransfer.files.length > 0) {
                fileInput.files = e.dataTransfer.files; // تعيين الملفات المسحوبة إلى حقل الإدخال
                updateFileUploadDisplay();
            }
        });

        // استدعاء أولي لتحديث العرض إذا كان هناك ملف مسبقًا (مثال: بعد فشل التحقق من صحة النموذج وإعادة تحميل الصفحة)
        updateFileUploadDisplay();
    }


    // *** بداية منطق النافذة المنبثقة للدفع في صفحة الإبلاغ ***
    const showPaymentModalForDirectUser = true;

    // عناصر النافذة المنبثقة الجديدة
    const paymentInfoModalReport = document.getElementById('payment-info-modal-report-missing');
    const closeReportModalBtn = document.getElementById('close-report-modal-btn');
    const displayPriceModalReport = document.getElementById('display-price-modal-report');
    const countdownMessageReport = document.getElementById('countdown-message-report');

    // المتغيرات لعداد السعر
    const jsInitialPrice = 4000;
    const jsExpiredPrice = 5000;
    const jsCountdownStartTime = 1754039011 * 1000; // Convert to milliseconds
    const jsCountdownDurationSeconds = 360;

    let countdownIntervalReport;

    function formatCurrency(amount) {
        return amount.toLocaleString('en-US'); // Formats with commas
    }

    function updateReportPrices(price) {
        if (displayPriceModalReport) {
            displayPriceModalReport.innerHTML = `${formatCurrency(price)} جنيه`;
        }
    }

    function updateReportCountdown() {
        const currentTime = Math.floor(Date.now() / 1000); // Current time in seconds
        const elapsedTime = currentTime - (jsCountdownStartTime / 1000);
        const remainingSeconds = jsCountdownDurationSeconds - elapsedTime;

        if (remainingSeconds > 0) {
            const minutes = Math.floor(remainingSeconds / 60);
            const seconds = Math.floor(remainingSeconds % 60);

            if (countdownMessageReport) {
                // النص الذي يخبر المستخدم بالسعر بعد انتهاء العداد
                countdownMessageReport.innerHTML = `سيصبح سعر فتح البلاغ ${formatCurrency(jsExpiredPrice)} جنيه بعد
                    <span style="color: #dc3545;">${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}</span>`;
            }
            updateReportPrices(jsInitialPrice); // Ensure initial price is shown while counting down
        } else {
            clearInterval(countdownIntervalReport);
            if (countdownMessageReport) {
                countdownMessageReport.innerHTML = ''; // Clear modal countdown message
            }
            updateReportPrices(jsExpiredPrice); // Update price to expired price
        }
    }

    if (showPaymentModalForDirectUser && paymentInfoModalReport && closeReportModalBtn) {
        // عرض النافذة المنبثقة عند تحميل الصفحة
        paymentInfoModalReport.classList.add('active');
        document.body.classList.add('modal-open');

        // بدء العداد
        countdownIntervalReport = setInterval(updateReportCountdown, 1000);
        updateReportCountdown(); // Initial call

        // إغلاق النافذة
        closeReportModalBtn.addEventListener('click', function() {
            paymentInfoModalReport.classList.remove('active');
            document.body.classList.remove('modal-open');
        });

        // إغلاق النافذة عند النقر خارجها
        window.addEventListener('click', function(event) {
            if (event.target == paymentInfoModalReport) {
                paymentInfoModalReport.classList.remove('active');
                document.body.classList.remove('modal-open');
            }
        });
    }
    // *** نهاية منطق النافذة المنبثقة للدفع في صفحة الإبلاغ ***

    // --- منطق نافذة النجاح للبلاغ ---
    const reportSuccessModal = document.getElementById('report-success-modal');
    const closeReportSuccessBtn = document.getElementById('close-report-success-btn');

    // إظهار النافذة إذا تم تقديم البلاغ بنجاح
    
    // إغلاق النافذة عند الضغط على الزر
    if (closeReportSuccessBtn) {
        closeReportSuccessBtn.addEventListener('click', function() {
            if (reportSuccessModal) {
                reportSuccessModal.classList.remove('active');
                document.body.classList.remove('modal-open');
            }
        });
    }

    // إغلاق النافذة عند الضغط خارجها
    if (reportSuccessModal) {
        reportSuccessModal.addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.remove('active');
                document.body.classList.remove('modal-open');
            }
        });
    }

    // إغلاق النافذة عند النقر على زر الإغلاق لـ Auth Modal
    if (closeButton) {
        closeButton.onclick = function(event) {
            event.stopPropagation(); // منع انتشار الحدث إلى overlay
            hideAuthModal();
        }
    }

    // إغلاق النافذة عند النقر خارجها لـ Auth Modal
    if (authModal) { // تأكد من وجود authModal
        authModal.addEventListener('click', function(event) {
            if (event.target === authModal) { // فقط إذا تم النقر على الخلفية (overlay) نفسها
                hideAuthModal();
            }
        });
    }

    // إعادة التوجيه إلى صفحة التسجيل
    if (redirectToRegister) {
        redirectToRegister.onclick = function() {
            window.location.href = 'register.php';
        }
    }

    // إعادة التوجيه إلى صفحة تسجيل الدخول
    if (redirectToLogin) {
        redirectToLogin.onclick = function() {
            window.location.href = 'login.php';
        }
    }
});

function handleSubmit(event) {
    // التحقق من تسجيل الدخول
    const userLoggedIn = true;
    if (!userLoggedIn) {
        event.preventDefault(); // منع إرسال النموذج
        showAuthModal(); // إعادة إظهار النافذة المنبثقة
        return false;
    }

    const maxReportsAllowed = 3;
    const currentUserReportsCount = 0;

    if (currentUserReportsCount >= maxReportsAllowed) {
        alert('لقد وصلت إلى الحد الأقصى من البلاغات المسموح بها (' + maxReportsAllowed + '). يرجى طلب زيادة الحد من صفحتك الشخصية.');
        event.preventDefault();
        return false;
    }

    // منع تكرار الإرسال
    let formSubmitted = false;
    const form = document.getElementById('missing-car-form');
    if (form.dataset.submitted) {
        event.preventDefault();
        return false;
    }

    // التحقق من أن رقم اللوحة أو رقم الشاسيه واحد على الأقل ممتلئ
    const plateNumber = document.getElementById('plate_number').value.trim();
    const chassisNumber = document.getElementById('chassis_number').value.trim();

    if (plateNumber === '' && chassisNumber === '') {
        alert('يجب إدخال رقم اللوحة أو رقم الشاسيه على الأقل.');
        event.preventDefault();
        return false;
    }

    // التحقق من رفع الإيصال للحسابات المباشرة (أضف هذا التحقق قبل إظهار السبينر)
    const registrationType = "direct";
    const receiptInput = document.getElementById('receipt');

    if (registrationType === 'direct' && receiptInput && receiptInput.hasAttribute('required') && !receiptInput.files[0]) {
        alert('يرجى رفع إيصال الدفع قبل تقديم البلاغ.');
        event.preventDefault();
        return false;
    }


    const submitBtn = document.getElementById('submit-btn');
    const submitText = document.getElementById('submit-text');
    const submitSpinner = document.getElementById('submit-spinner');

    submitText.classList.add('hidden');
    submitSpinner.classList.remove('hidden');
    submitBtn.disabled = true;
    form.dataset.submitted = 'true';
    formSubmitted = true;

    return true;
}
</script>




<footer>
    <div class="container">
        <div class="footer-content">
            <div class="footer-section">
                <h3>روابط سريعة</h3>
                <ul class="footer-links">
                    <li><a href="index">الرئيسية</a></li>
                    <li><a href="quick_search">البحث عن سيارة</a></li>
                    <li><a href="report_missing">الإبلاغ عن سيارة مفقودة</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>حسابي</h3>
                <ul class="footer-links">
                    <li><a href="login">تسجيل الدخول</a></li>
                    <li><a href="register">إنشاء حساب جديد</a></li>
                    <li><a href="profile">الملف الشخصي</a></li>
                    <li><a href="forgot_password">استعادة كلمة المرور</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>تواصل معنا</h3>
                <ul class="footer-links">
                    <li><a href="mailto:shaheid.net@gmail.com"><i class="fas fa-envelope"></i> البريد الإلكتروني</a></li>
                    <li><a href="tel:0918014555"><i class="fas fa-phone"></i> الهاتف</a></li>
                    <li><a href=""><i class="fab fa-facebook-f"></i> فيسبوك</a></li>
                    <li><a href="https://www.tiktok.com/@modi3033"><i class="fab fa-tiktok"></i> تيك توك</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>© 2025 مفقودات الحرب. جميع الحقوق محفوظة.</p>
        </div>
    </div>
</footer>

<!-- تحديث روابط ملفات JavaScript للتصميم الجديد -->
<script src="js/config.js"></script>
<script src="js/api.js"></script>
<script src="js/new-main.js"></script>
<div id="magictool-ext" data-theme="dark"></div></body></html>